{% extends "base.html" %}

{% block title %}Customer List{% endblock %}

{% block content %}
<style>
 .page-wrapper {
    display: flex;
    justify-content: center;
    padding: 30px 16px 60px;
    margin-top: 35px;   /* üî• Page ‡§ï‡•ã ‡§•‡•ã‡§°‡§º‡§æ ‡§®‡•Ä‡§ö‡•á ‡§≤‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è */
}


  .card-shell {
    width: 100%;
    max-width: 1100px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(3, 102, 214, 0.08);
    padding: 34px;
  }

  .page-title {
    display:flex;
    align-items:center;
    gap:10px;
    justify-content:center;
    font-size:1.6rem;
    font-weight:800;
    color:#222;
    margin-bottom:18px;
  }

  .controls {
    display:flex;
    justify-content:center;
    gap:12px;
    margin-bottom:20px;
    flex-wrap:wrap;
  }

  .controls .search {
    width:420px;
    max-width:100%;
    display:flex;
    gap:8px;
  }
  .controls input[type="text"]{
    flex:1;
    padding:11px 12px;
    border-radius:8px;
    border:1px solid #bbb;
    background:#fff;
    outline:none;
    font-size:15px;
  }

  .controls .btn {
    min-height:44px;
    padding:10px 18px;
    border-radius:8px;
    font-weight:700;
  }

  /* table wrapper (horizontal scroll on very small screens) */
  .table-wrap {
    overflow:auto;
    border-radius:10px;
  }

  table.custom-table {
    width:100%;
    border-collapse:collapse;
    min-width:920px;
  }

  table.custom-table thead th {
    background:#007bff;
    color:#fff;
    padding:14px;
    font-weight:700;
    text-align:center;
  }

  table.custom-table tbody td {
    padding:14px 12px;
    text-align:center;
    border-top:1px solid #eee;
    vertical-align:middle;
    color:#333;
  }

  table.custom-table tbody tr:nth-child(even){
    background:#f9fbff;
  }

  .action-buttons {
    display:flex;
    gap:8px;
    justify-content:center;
    flex-wrap:nowrap;
  }

  .btn-sm {
    font-size:14px;
    padding:7px 12px;
    border-radius:8px;
    font-weight:700;
    border:0;
    cursor:pointer;
    display:inline-block;
    text-decoration:none;
  }

  .btn-view { background:#0dc3d6;color:#fff; }
  .btn-edit { background:#0b82ff;color:#fff; }
  .btn-delete { background:#ff5864;color:#fff; }
  .btn-collect { background:#28a745;color:#fff; }
  .btn-disabled { background:#cfe0ff;color:#555; }

  /* ---- MOBILE: stacked card layout ----
     We'll hide the table and show cards for small screens.
     This avoids cramped table columns and preserves actions.
  */
  @media(max-width:640px){
    /* hide table version on small screens */
    .desktop-table { display:none; }

    /* show mobile cards */
    .mobile-cards { display:block; }

    .mobile-card {
      background:#fff;
      margin-bottom:12px;
      border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .mobile-card .row-top {
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }
    .mobile-card .title {
      font-weight:800;
      font-size:1rem;
      color:#222;
    }
    .mobile-card .sub {
      color:#666;
      font-size:0.85rem;
    }

    .mobile-card .grid {
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .mobile-card .grid .cell {
      flex:1 1 45%;
      background:#f7f9ff;
      padding:8px;
      border-radius:6px;
      font-size:0.92rem;
    }
    .mobile-card .actions {
      display:flex;
      gap:8px;
      justify-content:flex-end;
      margin-top:6px;
    }

    /* Slightly smaller paddings */
    .card-shell { padding:14px; }
    .controls { gap:8px; }
    .controls .search input { padding:9px; font-size:14px; }
  }

  /* hide mobile cards on larger screens */
  @media(min-width:641px){
    .mobile-cards { display:none; }
  }
</style>

<div class="page-wrapper">
  <div class="card-shell">

    <div class="page-title">üë• Customer List</div>

    <div class="controls">
      <form method="get" class="search">
        <input type="text" name="q" value="{{ q }}" placeholder="Search by name or phone...">
        <button type="submit" class="btn btn-primary">Search</button>
      </form>

      <a href="{% url 'add_customer' %}" class="btn btn-primary">+ Add Customer</a>
    </div>

    <div class="table-wrap">

      {# ---------- DESKTOP / TABLET TABLE (visible on md+) ---------- #}
      <div class="desktop-table">
        {% if customers %}
        <table class="custom-table">
          <thead>
            <tr>
              <th>#</th>
              <th style="text-align:left;padding-left:20px;">Customer Name</th>
              <th>Address</th>
              <th>Total Bills</th>
              <th>Total Amount (‚Çπ)</th>
              <th>Paid (‚Çπ)</th>
              <th>Remaining (‚Çπ)</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody>
            {% for customer in customers %}
            <tr data-customer-id="{{ customer.id }}">

              <td data-label="#"> {{ forloop.counter }} </td>

              <td data-label="Customer Name" style="text-align:left;padding-left:20px;">
                {{ customer.name }}
              </td>

              <td data-label="Address">{{ customer.address|default:"‚Äî" }}</td>

              <td data-label="Total Bills">{{ customer.total_bills }}</td>

              <td data-label="Total Amount">‚Çπ{{ customer.total_amount|floatformat:2 }}</td>

              <td class="col-paid" data-label="Paid">‚Çπ{{ customer.total_paid|floatformat:2 }}</td>

              <td class="col-remaining" data-label="Remaining">‚Çπ{{ customer.total_remaining|floatformat:2 }}</td>

              <td data-label="Action">
                <div class="action-buttons">

                  <a href="{% url 'customer_detail' customer.id %}" class="btn-sm btn-view">View</a>

                  <a href="{% url 'edit_customer' customer.id %}" class="btn-sm btn-edit">Edit</a>

                  <form method="post" action="{% url 'delete_customer' customer.id %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-sm btn-delete"
                      onclick="return confirm('Delete customer {{ customer.name }}?');">Delete</button>
                  </form>

                  {% if customer.total_remaining|floatformat:2 != "0.00" %}
                
                  {% else %}
                    <span class="btn-sm btn-disabled">Paid</span>
                  {% endif %}
                </div>
              </td>

            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          <div style="padding:25px;text-align:center;color:#666;">No customers found.</div>
        {% endif %}
      </div>
      {# ---------- end desktop table ---------- #}

      {# ---------- MOBILE STACKED CARDS (visible on small screens) ---------- #}
      <div class="mobile-cards">
        {% if customers %}
          {% for customer in customers %}
            <div class="mobile-card" id="cust-{{ customer.id }}">
              <div class="row-top">
                <div>
                  <div class="title">{{ customer.name }}</div>
                  <div class="sub">{{ customer.address|default:"‚Äî" }}</div>
                </div>
                <div style="text-align:right;">
                  <div style="font-weight:800;">Bills: {{ customer.total_bills }}</div>
                </div>
              </div>

              <div class="grid">
                <div class="cell">
                  <div class="small text-muted">Total</div>
                  <div>‚Çπ{{ customer.total_amount|floatformat:2 }}</div>
                </div>
                <div class="cell">
                  <div class="small text-muted">Paid</div>
                  <div>‚Çπ{{ customer.total_paid|floatformat:2 }}</div>
                </div>
                <div class="cell">
                  <div class="small text-muted">Remaining</div>
                  <div>‚Çπ{{ customer.total_remaining|floatformat:2 }}</div>
                </div>
                <div class="cell">
                  <div class="small text-muted">Phone</div>
                  <div>{{ customer.phone|default:"‚Äî" }}</div>
                </div>
              </div>

              <div class="actions">
                <a href="{% url 'customer_detail' customer.id %}" class="btn-sm btn-view">View</a>
                <a href="{% url 'edit_customer' customer.id %}" class="btn-sm btn-edit">Edit</a>
                <form method="post" action="{% url 'delete_customer' customer.id %}" style="display:inline;">
                  {% csrf_token %}
                  <button type="submit" class="btn-sm btn-delete" onclick="return confirm('Delete customer {{ customer.name }}?');">Delete</button>
                </form>
                {% if customer.total_remaining|floatformat:2 != "0.00" %}
                  .
                {% else %}
                  <span class="btn-sm btn-disabled">Paid</span>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div style="padding:10px;text-align:center;color:#666;">No customers found.</div>
        {% endif %}
      </div>
      {# ---------- end mobile cards ---------- #}

    </div>

  </div>
</div>

{% endblock %}

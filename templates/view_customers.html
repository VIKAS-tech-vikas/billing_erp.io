{% extends "base.html" %}
{% block title %}Customer List{% endblock %}
{% block content %}

<style>
/* ‚≠ê LIGHT BACKGROUND (Same theme as Create Bill) */
body {
  background: linear-gradient(180deg, #d7e9ff, #e9f3ff) !important;
  min-height: 100vh;
  padding-bottom: 40px;
}

/* ‚ùó Remove old glow */
body::before,
body::after {
  content: none !important;
}

/* MAIN CARD */
.page-wrapper { display:flex; justify-content:center; padding:30px 14px 70px; }
.card-shell {
  width:100%; max-width:1200px;
  background:#fff;
  border-radius:26px;
  padding:40px;
  box-shadow:0px 15px 45px rgba(0, 68, 255, 0.20);
}

/* HEADING */
.page-title {
  text-align:center;
  font-size:34px;
  font-weight:900;
  color:#0050ff;
  margin-bottom:28px;
}

/* SEARCH + ADD */
.controls {
  display:flex;
  justify-content:center;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:22px;
}
.controls form { display:flex; align-items:center; gap:10px; }
.controls input {
  padding:12px 14px;
  border-radius:12px;
  border:2px solid #b7d0ff;
  font-size:15px;
  width:260px;
}
.btn-primary {
  background:#006bff;
  padding:12px 20px;
  border-radius:12px;
  border:none;
  color:white;
  font-weight:750;
  cursor:pointer;
}
.btn-primary:hover { transform:translateY(-3px); }

/* MOBILE SEARCH FIX */
@media(max-width:640px){
  .controls form {
    flex-direction: column;
    width:100%;
  }
  .controls input,
  .controls button {
    width:100% !important;
  }
  .controls { gap:8px; }
}

/* TABLE SCROLL BOX */
.table-wrap {
  max-height: 450px;
  overflow-y: auto;
  overflow-x: auto;
  border-radius: 14px;
  border: 2px solid #dce7ff;
}

/* Scroll style */
.table-wrap::-webkit-scrollbar { width: 8px; height: 8px; }
.table-wrap::-webkit-scrollbar-thumb { background:#90baff; border-radius: 6px; }
.table-wrap::-webkit-scrollbar-track { background:#e9f1ff; }

/* TABLE */
table.custom-table { width:100%; border-collapse:collapse; min-width:900px; }
thead th {
  background:#006bff;
  color:white;
  padding:15px;
  font-size:15px;
  position: sticky;
  top: 0;
  z-index: 2;
}
tbody td {
  padding:13px;
  border-top:1px solid #dce7ff;
  font-size:15px;
}
tbody tr:hover { background:#eaf2ff; transition:.25s; }
.row-success { color:#00b76a; font-weight:700; }
.row-danger { color:#ff3d3d; font-weight:700; }

/* ACTION BUTTONS */
.action-buttons{ display:flex; gap:8px; justify-content:center; }
.btn-sm { border:none; padding:8px 14px; font-weight:700; border-radius:10px; color:white; cursor:pointer; }
.btn-view { background:#00c6b1; }
.btn-edit { background:#007bff; }
.btn-delete { background:#ff3b3b; }

/* üì± MOBILE CARD VIEW */
@media(max-width:640px){
  .desktop-table{ display:none; }
  .mobile-cards{ display:block; }
  .table-wrap{ max-height:none; border:none; }

  .mobile-card{
    background:#fff;
    border-radius:14px;
    padding:16px;
    margin-bottom:16px;
    box-shadow:0 0 20px rgba(0,110,255,.12);
  }
  .mobile-card .title{
    font-weight:850;
    font-size:1.2rem;
    color:#0050ff;
    margin-bottom:6px;
  }
  .mobile-card .grid{ display:flex; flex-wrap:wrap; gap:10px; }
  .mobile-card .cell{
    background:#f4f7ff;
    padding:10px;
    border-radius:10px;
    flex:1 1 42%;
    font-size:0.92rem;
  }
  .mobile-card .actions{
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:15px;
    flex-wrap:wrap;
  }
  .mobile-card .actions .btn-sm{
    flex:1 1 auto;
    text-align:center;
    padding:10px 12px;
    border-radius:12px;
    font-size:15px;
  }
}

@media(min-width:641px){ .mobile-cards{ display:none; } }
</style>


<div class="page-wrapper">
  <div class="card-shell">

    <div class="page-title">üë• Customer List</div>

    <div class="controls">
      <form method="get">
        <input type="text" name="q" value="{{ q }}" placeholder="Search by name or phone...">
        <button class="btn-primary">Search</button>
      </form>
      <a href="{% url 'add_customer' %}" class="btn-primary">+ Add Customer</a>
    </div>

    <div class="table-wrap">

      <!-- üíª DESKTOP TABLE -->
      <div class="desktop-table">
        {% if customers %}
        <table class="custom-table">
          <thead>
            <tr>
              <th>#</th><th>Name</th><th>Address</th><th>Bills</th>
              <th>Total</th><th>Paid</th><th>Remaining</th><th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for c in customers %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td style="text-align:left;padding-left:16px;">
                <a href="{% url 'customer_detail' c.id %}" style="color:#004bcb;font-weight:700;text-decoration:none;">
                  {{ c.name }}
                </a>
              </td>
              <td>{{ c.address|default:"‚Äî" }}</td>
              <td>{{ c.total_bills }}</td>
              <td>‚Çπ{{ c.total_amount|floatformat:2 }}</td>
              <td class="row-success">‚Çπ{{ c.total_paid|floatformat:2 }}</td>
              <td class="{% if c.total_remaining != 0 %}row-danger{% else %}row-success{% endif %}">
                ‚Çπ{{ c.total_remaining|floatformat:2 }}
              </td>
              <td>
                <div class="action-buttons">
                  <a href="{% url 'customer_detail' c.id %}" class="btn-sm btn-view">View</a>
                  <a href="{% url 'edit_customer' c.id %}" class="btn-sm btn-edit">Edit</a>
                  <form method="post" action="{% url 'delete_customer' c.id %}">
                    {% csrf_token %}
                    <button class="btn-sm btn-delete" onclick="return confirm('Delete {{ c.name }}?');">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div style="padding:22px;text-align:center;color:#666;">No customers found.</div>
        {% endif %}
      </div>

      <!-- üì± MOBILE CARDS -->
      <div class="mobile-cards">
        {% for c in customers %}
        <div class="mobile-card">
          <div class="title">{{ c.name }}</div>
          <div class="grid">
            <div class="cell"><b>Total:</b> ‚Çπ{{ c.total_amount|floatformat:2 }}</div>
            <div class="cell"><b>Paid:</b> ‚Çπ{{ c.total_paid|floatformat:2 }}</div>
            <div class="cell"><b>Remaining:</b> ‚Çπ{{ c.total_remaining|floatformat:2 }}</div>
            <div class="cell"><b>Bills:</b> {{ c.total_bills }}</div>
          </div>

          <div class="actions">
            <a href="{% url 'customer_detail' c.id %}" class="btn-sm btn-view">View</a>
            <a href="{% url 'edit_customer' c.id %}" class="btn-sm btn-edit">Edit</a>
            <form method="post" action="{% url 'delete_customer' c.id %}">
              {% csrf_token %}
              <button class="btn-sm btn-delete" onclick="return confirm('Delete {{ c.name }}?');">Delete</button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>

    </div>
  </div>
</div>
{% endblock %}
